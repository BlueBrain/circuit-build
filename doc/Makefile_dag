# create dag images using `snakemake --dag`

SELF_DIR = $(dir $(lastword $(MAKEFILE_LIST)))
BASE_DIR = $(SELF_DIR)/..
OUT_DIR = $(BASE_DIR)/doc/source/dag
BIONAME = $(BASE_DIR)/tests/proj66-tiny/
SNAKEFILE = $(BASE_DIR)/snakemake/Snakefile
SM = snakemake --snakefile $(SNAKEFILE) --config bioname=$(BIONAME) --dag --

dag:
	mkdir -p subcellular  # needed for subcellular rule
	mkdir -p $(OUT_DIR)
	$(SM) default > $(OUT_DIR)/default.dot
	$(SM) functional > $(OUT_DIR)/functional.dot
	$(SM) spatial_index_segment > $(OUT_DIR)/spatial_index_segment.dot
	$(SM) spatial_index_synapse > $(OUT_DIR)/spatial_index_synapse.dot
	$(SM) structural > $(OUT_DIR)/structural.dot
	$(SM) subcellular > $(OUT_DIR)/subcellular.dot
	$(SM) functional_all > $(OUT_DIR)/functional_all.dot
	rmdir -p subcellular
